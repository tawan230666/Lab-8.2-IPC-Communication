<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 8.2 - IPC Communication Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .button:hover {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
        }

        .result-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .loading {
            color: #ffd700;
            font-style: italic;
        }

        .success {
            color: #90ee90;
        }

        .error {
            color: #ff6b6b;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ IPC Communication Demo</h1>
            <p>‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Main Process ‡πÅ‡∏•‡∏∞ Renderer Process</p>
        </div>

        <!-- Demo 1: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
        <div class="demo-section">
            <h3>üì§ Demo 1: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ Main Process</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö response ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤</p>

            <div class="input-group">
                <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á:</label>
                <input type="text" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
                    value="Hello from Renderer Process!">
            </div>

            <button class="button" onclick="sendMessage()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
            <button class="button" onclick="clearResult('messageResult')">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>

            <div class="result-box" id="messageResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö IPC</div>
        </div>

        <!-- Demo 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ -->
        <div class="demo-section">
            <h3>üëã Demo 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ Agent</h3>
            <p>‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£ login ‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô agent wallboard</p>

            <div class="input-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠ Agent:</label>
                <input type="text" id="agentName" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." value="Agent001">
            </div>

            <button class="button" onclick="sayHello()">üëã ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <button class="button" onclick="clearResult('helloResult')">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>

            <div class="result-box" id="helloResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢</div>
        </div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Process -->
        <div class="demo-section">
            <h3>üìä Process Information</h3>
            <div class="result-box">
                üñ•Ô∏è <strong>Main Process:</strong> ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Node.js environment, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ business logic
                üé® <strong>Renderer Process:</strong> ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Chromium environment, ‡πÅ‡∏™‡∏î‡∏á UI
                üåâ <strong>Preload Script:</strong> ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö IPC communication

                <strong>üîÑ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</strong>
                1. Renderer ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å window.electronAPI.sendMessage()
                2. Preload ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ Main ‡∏î‡πâ‡∏ß‡∏¢ ipcRenderer.invoke()
                3. Main ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ ipcMain.handle()
                4. Main ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö
                5. Renderer ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            </div>
        </div>
         <!-- Demo 3: Agent Wallboard Functions -->
    <div class="demo-section">
        <h3>üìä Demo 3: Agent Wallboard Functions</h3>
        <p>‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö wallboard app)</p>

        <button class="button" onclick="loadAgents()">üìä ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agents</button>
        <button class="button" onclick="showStatusSelector()">üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
        <button class="button" onclick="clearResult('agentResult')">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>

        <div id="statusSelector" style="display: none; margin: 15px 0;">
            <select id="agentSelect" style="padding: 8px; margin-right: 10px;">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Agent</option>
            </select>

            <select id="statusSelect" style="padding: 8px; margin-right: 10px;">
                <option value="Available">Available</option>
                <option value="Busy">Busy</option>
                <option value="Break">Break</option>
                <option value="Offline">Offline</option>
            </select>

            <button class="button" onclick="changeStatus()">‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
        </div>

        <div class="result-box" id="agentResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agents" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>
    </div>
    </div>
    <script>
        console.log('üé® [RENDERER] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ electronAPI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        if (window.electronAPI) {
            console.log('‚úÖ [RENDERER] electronAPI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        } else {
            console.error('‚ùå [RENDERER] electronAPI ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        function displayResult(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString('th-TH');

            let content;
            if (typeof data === 'object') {
                content = JSON.stringify(data, null, 2);
            } else {
                content = data.toString();
            }

            element.innerHTML = `[${timestamp}] ${content}`;
            element.className = `result-box ${type}`;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        async function sendMessage() {
            const message = document.getElementById('messageInput').value;

            if (!message.trim()) {
                displayResult('messageResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'error');
                return;
            }

            try {
                console.log('üì§ [RENDERER] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:', message);
                displayResult('messageResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...', 'loading');

                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ Main Process
                const response = await window.electronAPI.sendMessage(message);

                console.log('üì• [RENDERER] ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö response:', response);
                displayResult('messageResult', response, 'success');

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
                displayResult('messageResult', `Error: ${error.message}`, 'error');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢
        async function sayHello() {
            const name = document.getElementById('agentName').value;

            if (!name.trim()) {
                displayResult('helloResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ Agent', 'error');
                return;
            }

            try {
                console.log('üëã [RENDERER] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢:', name);
                displayResult('helloResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'loading');

                // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÑ‡∏õ Main Process
                const response = await window.electronAPI.sayHello(name);

                console.log('üì• [RENDERER] ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢:', response);

                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
                const resultText = `
üéâ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!

üë§ Agent: ${response.name}
üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${response.greeting}
‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${response.time}
üë• Agents ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: ${response.agentCount} ‡∏Ñ‡∏ô

‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`;

                displayResult('helloResult', resultText, 'success');

            } catch (error) {
                console.error('‚ùå [RENDERER] Error:', error);
                displayResult('helloResult', `Error: ${error.message}`, 'error');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        function clearResult(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß...';
            element.className = 'result-box';
        }

        // Event Listeners
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        document.getElementById('agentName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sayHello();
            }
        });

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ page ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ [RENDERER] HTML ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à');
        });

        window.addEventListener('load', () => {
            console.log('‚úÖ [RENDERER] ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß');
        });

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô <script> ‡∏Ç‡∏≠‡∏á index.html

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents
        let agentsData = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents
        async function loadAgents() {
            try {
                console.log('üìä [RENDERER] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents...');
                displayResult('agentResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents...', 'loading');

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ú‡πà‡∏≤‡∏ô IPC
                const response = await window.electronAPI.getAgents();

                if (response.success) {
                    agentsData = response.data;
                    console.log('‚úÖ [RENDERER] ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', agentsData);

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents
                    displayAgentData(agentsData);

                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó dropdown ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    updateAgentSelector(agentsData.agents);

                } else {
                    throw new Error(response.error);
                }

            } catch (error) {
                console.error('‚ùå [RENDERER] Error ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
                displayResult('agentResult', `Error: ${error.message}`, 'error');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents
        function displayAgentData(data) {
            const agentList = data.agents.map(agent => {
                const statusEmoji = {
                    'Available': 'üü¢',
                    'Busy': 'üî¥',
                    'Break': 'üü°',
                    'Offline': '‚ö´'
                };

                return `${statusEmoji[agent.status] || '‚ùì'} ${agent.name} (${agent.id})
   üìû Ext: ${agent.extension} | üè¢ ${agent.department}
   üìä Calls: ${agent.totalCalls} | ‚è±Ô∏è Avg: ${agent.avgCallTime}s`;
            }).join('\n\n');

            const statistics = data.statistics;

            const resultText = `
üìä AGENT WALLBOARD DATA
======================

üë• AGENTS (${statistics.totalAgents} ‡∏Ñ‡∏ô):
${agentList}

üìà STATISTICS:
üü¢ Available: ${statistics.availableAgents} ‡∏Ñ‡∏ô
üî¥ Busy: ${statistics.busyAgents} ‡∏Ñ‡∏ô  
üü° Break: ${statistics.onBreakAgents} ‡∏Ñ‡∏ô
üìû Total Calls Today: ${statistics.totalCallsToday}
‚è∞ Avg Wait Time: ${statistics.avgWaitTime}s

‚è∞ Last Updated: ${new Date().toLocaleString('th-TH')}`;

            displayResult('agentResult', resultText, 'success');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó dropdown ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å agent
        function updateAgentSelector(agents) {
            const agentSelect = document.getElementById('agentSelect');
            agentSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Agent</option>';

            agents.forEach(agent => {
                const option = document.createElement('option');
                option.value = agent.id;
                option.textContent = `${agent.name} (${agent.id}) - ${agent.status}`;
                agentSelect.appendChild(option);
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô status selector
        function showStatusSelector() {
            if (!agentsData) {
                displayResult('agentResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agents ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            const selector = document.getElementById('statusSelector');
            selector.style.display = selector.style.display === 'none' ? 'block' : 'none';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ agent
        async function changeStatus() {
            const agentId = document.getElementById('agentSelect').value;
            const newStatus = document.getElementById('statusSelect').value;

            if (!agentId || !newStatus) {
                displayResult('agentResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Agent ‡πÅ‡∏•‡∏∞ Status', 'error');
                return;
            }

            try {
                console.log(`üîÑ [RENDERER] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ${agentId} ‡πÄ‡∏õ‡πá‡∏ô ${newStatus}`);
                displayResult('agentResult', `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ${agentId}...`, 'loading');

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                const response = await window.electronAPI.changeAgentStatus(agentId, newStatus);

                if (response.success) {
                    console.log('‚úÖ [RENDERER] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', response);

                    const resultText = `
‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!

üë§ Agent: ${response.agent.name} (${response.agent.id})
üîÑ Status: ${response.agent.status}
‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(response.agent.lastStatusChange).toLocaleString('th-TH')}

${response.message}`;

                    displayResult('agentResult', resultText, 'success');

                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                    setTimeout(() => {
                        loadAgents();
                    }, 2000);

                } else {
                    throw new Error(response.error);
                }

            } catch (error) {
                console.error('‚ùå [RENDERER] Error ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:', error);
                displayResult('agentResult', `Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>

</html>